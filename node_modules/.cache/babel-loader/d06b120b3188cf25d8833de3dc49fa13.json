{"ast":null,"code":"import extend from 'extend';\nimport Delta from 'quill-delta';\nimport Emitter from '../core/emitter';\nimport Keyboard from '../modules/keyboard';\nimport Theme from '../core/theme';\nimport ColorPicker from '../ui/color-picker';\nimport IconPicker from '../ui/icon-picker';\nimport Picker from '../ui/picker';\nimport Tooltip from '../ui/tooltip';\nconst ALIGNS = [false, 'center', 'right', 'justify'];\nconst COLORS = [\"#000000\", \"#e60000\", \"#ff9900\", \"#ffff00\", \"#008a00\", \"#0066cc\", \"#9933ff\", \"#ffffff\", \"#facccc\", \"#ffebcc\", \"#ffffcc\", \"#cce8cc\", \"#cce0f5\", \"#ebd6ff\", \"#bbbbbb\", \"#f06666\", \"#ffc266\", \"#ffff66\", \"#66b966\", \"#66a3e0\", \"#c285ff\", \"#888888\", \"#a10000\", \"#b26b00\", \"#b2b200\", \"#006100\", \"#0047b2\", \"#6b24b2\", \"#444444\", \"#5c0000\", \"#663d00\", \"#666600\", \"#003700\", \"#002966\", \"#3d1466\"];\nconst FONTS = [false, 'serif', 'monospace'];\nconst HEADERS = ['1', '2', '3', false];\nconst SIZES = ['small', false, 'large', 'huge'];\n\nclass BaseTheme extends Theme {\n  constructor(quill, options) {\n    super(quill, options);\n\n    let listener = e => {\n      if (!document.body.contains(quill.root)) {\n        return document.body.removeEventListener('click', listener);\n      }\n\n      if (this.tooltip != null && !this.tooltip.root.contains(e.target) && document.activeElement !== this.tooltip.textbox && !this.quill.hasFocus()) {\n        this.tooltip.hide();\n      }\n\n      if (this.pickers != null) {\n        this.pickers.forEach(function (picker) {\n          if (!picker.container.contains(e.target)) {\n            picker.close();\n          }\n        });\n      }\n    };\n\n    quill.emitter.listenDOM('click', document.body, listener);\n  }\n\n  addModule(name) {\n    let module = super.addModule(name);\n\n    if (name === 'toolbar') {\n      this.extendToolbar(module);\n    }\n\n    return module;\n  }\n\n  buildButtons(buttons, icons) {\n    buttons.forEach(button => {\n      let className = button.getAttribute('class') || '';\n      className.split(/\\s+/).forEach(name => {\n        if (!name.startsWith('ql-')) return;\n        name = name.slice('ql-'.length);\n        if (icons[name] == null) return;\n\n        if (name === 'direction') {\n          button.innerHTML = icons[name][''] + icons[name]['rtl'];\n        } else if (typeof icons[name] === 'string') {\n          button.innerHTML = icons[name];\n        } else {\n          let value = button.value || '';\n\n          if (value != null && icons[name][value]) {\n            button.innerHTML = icons[name][value];\n          }\n        }\n      });\n    });\n  }\n\n  buildPickers(selects, icons) {\n    this.pickers = selects.map(select => {\n      if (select.classList.contains('ql-align')) {\n        if (select.querySelector('option') == null) {\n          fillSelect(select, ALIGNS);\n        }\n\n        return new IconPicker(select, icons.align);\n      } else if (select.classList.contains('ql-background') || select.classList.contains('ql-color')) {\n        let format = select.classList.contains('ql-background') ? 'background' : 'color';\n\n        if (select.querySelector('option') == null) {\n          fillSelect(select, COLORS, format === 'background' ? '#ffffff' : '#000000');\n        }\n\n        return new ColorPicker(select, icons[format]);\n      } else {\n        if (select.querySelector('option') == null) {\n          if (select.classList.contains('ql-font')) {\n            fillSelect(select, FONTS);\n          } else if (select.classList.contains('ql-header')) {\n            fillSelect(select, HEADERS);\n          } else if (select.classList.contains('ql-size')) {\n            fillSelect(select, SIZES);\n          }\n        }\n\n        return new Picker(select);\n      }\n    });\n\n    let update = () => {\n      this.pickers.forEach(function (picker) {\n        picker.update();\n      });\n    };\n\n    this.quill.on(Emitter.events.EDITOR_CHANGE, update);\n  }\n\n}\n\nBaseTheme.DEFAULTS = extend(true, {}, Theme.DEFAULTS, {\n  modules: {\n    toolbar: {\n      handlers: {\n        formula: function () {\n          this.quill.theme.tooltip.edit('formula');\n        },\n        image: function () {\n          let fileInput = this.container.querySelector('input.ql-image[type=file]');\n\n          if (fileInput == null) {\n            fileInput = document.createElement('input');\n            fileInput.setAttribute('type', 'file');\n            fileInput.setAttribute('accept', 'image/png, image/gif, image/jpeg, image/bmp, image/x-icon');\n            fileInput.classList.add('ql-image');\n            fileInput.addEventListener('change', () => {\n              if (fileInput.files != null && fileInput.files[0] != null) {\n                let reader = new FileReader();\n\n                reader.onload = e => {\n                  let range = this.quill.getSelection(true);\n                  this.quill.updateContents(new Delta().retain(range.index).delete(range.length).insert({\n                    image: e.target.result\n                  }), Emitter.sources.USER);\n                  this.quill.setSelection(range.index + 1, Emitter.sources.SILENT);\n                  fileInput.value = \"\";\n                };\n\n                reader.readAsDataURL(fileInput.files[0]);\n              }\n            });\n            this.container.appendChild(fileInput);\n          }\n\n          fileInput.click();\n        },\n        video: function () {\n          this.quill.theme.tooltip.edit('video');\n        }\n      }\n    }\n  }\n});\n\nclass BaseTooltip extends Tooltip {\n  constructor(quill, boundsContainer) {\n    super(quill, boundsContainer);\n    this.textbox = this.root.querySelector('input[type=\"text\"]');\n    this.listen();\n  }\n\n  listen() {\n    this.textbox.addEventListener('keydown', event => {\n      if (Keyboard.match(event, 'enter')) {\n        this.save();\n        event.preventDefault();\n      } else if (Keyboard.match(event, 'escape')) {\n        this.cancel();\n        event.preventDefault();\n      }\n    });\n  }\n\n  cancel() {\n    this.hide();\n  }\n\n  edit(mode = 'link', preview = null) {\n    this.root.classList.remove('ql-hidden');\n    this.root.classList.add('ql-editing');\n\n    if (preview != null) {\n      this.textbox.value = preview;\n    } else if (mode !== this.root.getAttribute('data-mode')) {\n      this.textbox.value = '';\n    }\n\n    this.position(this.quill.getBounds(this.quill.selection.savedRange));\n    this.textbox.select();\n    this.textbox.setAttribute('placeholder', this.textbox.getAttribute(`data-${mode}`) || '');\n    this.root.setAttribute('data-mode', mode);\n  }\n\n  restoreFocus() {\n    let scrollTop = this.quill.scrollingContainer.scrollTop;\n    this.quill.focus();\n    this.quill.scrollingContainer.scrollTop = scrollTop;\n  }\n\n  save() {\n    let value = this.textbox.value;\n\n    switch (this.root.getAttribute('data-mode')) {\n      case 'link':\n        {\n          let scrollTop = this.quill.root.scrollTop;\n\n          if (this.linkRange) {\n            this.quill.formatText(this.linkRange, 'link', value, Emitter.sources.USER);\n            delete this.linkRange;\n          } else {\n            this.restoreFocus();\n            this.quill.format('link', value, Emitter.sources.USER);\n          }\n\n          this.quill.root.scrollTop = scrollTop;\n          break;\n        }\n\n      case 'video':\n        {\n          value = extractVideoUrl(value);\n        }\n      // eslint-disable-next-line no-fallthrough\n\n      case 'formula':\n        {\n          if (!value) break;\n          let range = this.quill.getSelection(true);\n\n          if (range != null) {\n            let index = range.index + range.length;\n            this.quill.insertEmbed(index, this.root.getAttribute('data-mode'), value, Emitter.sources.USER);\n\n            if (this.root.getAttribute('data-mode') === 'formula') {\n              this.quill.insertText(index + 1, ' ', Emitter.sources.USER);\n            }\n\n            this.quill.setSelection(index + 2, Emitter.sources.USER);\n          }\n\n          break;\n        }\n\n      default:\n    }\n\n    this.textbox.value = '';\n    this.hide();\n  }\n\n}\n\nfunction extractVideoUrl(url) {\n  let match = url.match(/^(?:(https?):\\/\\/)?(?:(?:www|m)\\.)?youtube\\.com\\/watch.*v=([a-zA-Z0-9_-]+)/) || url.match(/^(?:(https?):\\/\\/)?(?:(?:www|m)\\.)?youtu\\.be\\/([a-zA-Z0-9_-]+)/);\n\n  if (match) {\n    return (match[1] || 'https') + '://www.youtube.com/embed/' + match[2] + '?showinfo=0';\n  }\n\n  if (match = url.match(/^(?:(https?):\\/\\/)?(?:www\\.)?vimeo\\.com\\/(\\d+)/)) {\n    // eslint-disable-line no-cond-assign\n    return (match[1] || 'https') + '://player.vimeo.com/video/' + match[2] + '/';\n  }\n\n  return url;\n}\n\nfunction fillSelect(select, values, defaultValue = false) {\n  values.forEach(function (value) {\n    let option = document.createElement('option');\n\n    if (value === defaultValue) {\n      option.setAttribute('selected', 'selected');\n    } else {\n      option.setAttribute('value', value);\n    }\n\n    select.appendChild(option);\n  });\n}\n\nexport { BaseTooltip, BaseTheme as default };","map":{"version":3,"sources":["/Users/albab/bookapro/amazon/src/assets/vendor/quill/themes/base.js"],"names":["extend","Delta","Emitter","Keyboard","Theme","ColorPicker","IconPicker","Picker","Tooltip","ALIGNS","COLORS","FONTS","HEADERS","SIZES","BaseTheme","constructor","quill","options","listener","e","document","body","contains","root","removeEventListener","tooltip","target","activeElement","textbox","hasFocus","hide","pickers","forEach","picker","container","close","emitter","listenDOM","addModule","name","module","extendToolbar","buildButtons","buttons","icons","button","className","getAttribute","split","startsWith","slice","length","innerHTML","value","buildPickers","selects","map","select","classList","querySelector","fillSelect","align","format","update","on","events","EDITOR_CHANGE","DEFAULTS","modules","toolbar","handlers","formula","theme","edit","image","fileInput","createElement","setAttribute","add","addEventListener","files","reader","FileReader","onload","range","getSelection","updateContents","retain","index","delete","insert","result","sources","USER","setSelection","SILENT","readAsDataURL","appendChild","click","video","BaseTooltip","boundsContainer","listen","event","match","save","preventDefault","cancel","mode","preview","remove","position","getBounds","selection","savedRange","restoreFocus","scrollTop","scrollingContainer","focus","linkRange","formatText","extractVideoUrl","insertEmbed","insertText","url","values","defaultValue","option","default"],"mappings":"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","sourcesContent":["import extend from 'extend';\nimport Delta from 'quill-delta';\nimport Emitter from '../core/emitter';\nimport Keyboard from '../modules/keyboard';\nimport Theme from '../core/theme';\nimport ColorPicker from '../ui/color-picker';\nimport IconPicker from '../ui/icon-picker';\nimport Picker from '../ui/picker';\nimport Tooltip from '../ui/tooltip';\n\n\nconst ALIGNS = [ false, 'center', 'right', 'justify' ];\n\nconst COLORS = [\n  \"#000000\", \"#e60000\", \"#ff9900\", \"#ffff00\", \"#008a00\", \"#0066cc\", \"#9933ff\",\n  \"#ffffff\", \"#facccc\", \"#ffebcc\", \"#ffffcc\", \"#cce8cc\", \"#cce0f5\", \"#ebd6ff\",\n  \"#bbbbbb\", \"#f06666\", \"#ffc266\", \"#ffff66\", \"#66b966\", \"#66a3e0\", \"#c285ff\",\n  \"#888888\", \"#a10000\", \"#b26b00\", \"#b2b200\", \"#006100\", \"#0047b2\", \"#6b24b2\",\n  \"#444444\", \"#5c0000\", \"#663d00\", \"#666600\", \"#003700\", \"#002966\", \"#3d1466\"\n];\n\nconst FONTS = [ false, 'serif', 'monospace' ];\n\nconst HEADERS = [ '1', '2', '3', false ];\n\nconst SIZES = [ 'small', false, 'large', 'huge' ];\n\n\nclass BaseTheme extends Theme {\n  constructor(quill, options) {\n    super(quill, options);\n    let listener = (e) => {\n      if (!document.body.contains(quill.root)) {\n        return document.body.removeEventListener('click', listener);\n      }\n      if (this.tooltip != null && !this.tooltip.root.contains(e.target) &&\n          document.activeElement !== this.tooltip.textbox && !this.quill.hasFocus()) {\n        this.tooltip.hide();\n      }\n      if (this.pickers != null) {\n        this.pickers.forEach(function(picker) {\n          if (!picker.container.contains(e.target)) {\n            picker.close();\n          }\n        });\n      }\n    };\n    quill.emitter.listenDOM('click', document.body, listener);\n  }\n\n  addModule(name) {\n    let module = super.addModule(name);\n    if (name === 'toolbar') {\n      this.extendToolbar(module);\n    }\n    return module;\n  }\n\n  buildButtons(buttons, icons) {\n    buttons.forEach((button) => {\n      let className = button.getAttribute('class') || '';\n      className.split(/\\s+/).forEach((name) => {\n        if (!name.startsWith('ql-')) return;\n        name = name.slice('ql-'.length);\n        if (icons[name] == null) return;\n        if (name === 'direction') {\n          button.innerHTML = icons[name][''] + icons[name]['rtl'];\n        } else if (typeof icons[name] === 'string') {\n          button.innerHTML = icons[name];\n        } else {\n          let value = button.value || '';\n          if (value != null && icons[name][value]) {\n            button.innerHTML = icons[name][value];\n          }\n        }\n      });\n    });\n  }\n\n  buildPickers(selects, icons) {\n    this.pickers = selects.map((select) => {\n      if (select.classList.contains('ql-align')) {\n        if (select.querySelector('option') == null) {\n          fillSelect(select, ALIGNS);\n        }\n        return new IconPicker(select, icons.align);\n      } else if (select.classList.contains('ql-background') || select.classList.contains('ql-color')) {\n        let format = select.classList.contains('ql-background') ? 'background' : 'color';\n        if (select.querySelector('option') == null) {\n          fillSelect(select, COLORS, format === 'background' ? '#ffffff' : '#000000');\n        }\n        return new ColorPicker(select, icons[format]);\n      } else {\n        if (select.querySelector('option') == null) {\n          if (select.classList.contains('ql-font')) {\n            fillSelect(select, FONTS);\n          } else if (select.classList.contains('ql-header')) {\n            fillSelect(select, HEADERS);\n          } else if (select.classList.contains('ql-size')) {\n            fillSelect(select, SIZES);\n          }\n        }\n        return new Picker(select);\n      }\n    });\n    let update = () => {\n      this.pickers.forEach(function(picker) {\n        picker.update();\n      });\n    };\n    this.quill.on(Emitter.events.EDITOR_CHANGE, update);\n  }\n}\nBaseTheme.DEFAULTS = extend(true, {}, Theme.DEFAULTS, {\n  modules: {\n    toolbar: {\n      handlers: {\n        formula: function() {\n          this.quill.theme.tooltip.edit('formula');\n        },\n        image: function() {\n          let fileInput = this.container.querySelector('input.ql-image[type=file]');\n          if (fileInput == null) {\n            fileInput = document.createElement('input');\n            fileInput.setAttribute('type', 'file');\n            fileInput.setAttribute('accept', 'image/png, image/gif, image/jpeg, image/bmp, image/x-icon');\n            fileInput.classList.add('ql-image');\n            fileInput.addEventListener('change', () => {\n              if (fileInput.files != null && fileInput.files[0] != null) {\n                let reader = new FileReader();\n                reader.onload = (e) => {\n                  let range = this.quill.getSelection(true);\n                  this.quill.updateContents(new Delta()\n                    .retain(range.index)\n                    .delete(range.length)\n                    .insert({ image: e.target.result })\n                  , Emitter.sources.USER);\n                  this.quill.setSelection(range.index + 1, Emitter.sources.SILENT);\n                  fileInput.value = \"\";\n                }\n                reader.readAsDataURL(fileInput.files[0]);\n              }\n            });\n            this.container.appendChild(fileInput);\n          }\n          fileInput.click();\n        },\n        video: function() {\n          this.quill.theme.tooltip.edit('video');\n        }\n      }\n    }\n  }\n});\n\n\nclass BaseTooltip extends Tooltip {\n  constructor(quill, boundsContainer) {\n    super(quill, boundsContainer);\n    this.textbox = this.root.querySelector('input[type=\"text\"]');\n    this.listen();\n  }\n\n  listen() {\n    this.textbox.addEventListener('keydown', (event) => {\n      if (Keyboard.match(event, 'enter')) {\n        this.save();\n        event.preventDefault();\n      } else if (Keyboard.match(event, 'escape')) {\n        this.cancel();\n        event.preventDefault();\n      }\n    });\n  }\n\n  cancel() {\n    this.hide();\n  }\n\n  edit(mode = 'link', preview = null) {\n    this.root.classList.remove('ql-hidden');\n    this.root.classList.add('ql-editing');\n    if (preview != null) {\n      this.textbox.value = preview;\n    } else if (mode !== this.root.getAttribute('data-mode')) {\n      this.textbox.value = '';\n    }\n    this.position(this.quill.getBounds(this.quill.selection.savedRange));\n    this.textbox.select();\n    this.textbox.setAttribute('placeholder', this.textbox.getAttribute(`data-${mode}`) || '');\n    this.root.setAttribute('data-mode', mode);\n  }\n\n  restoreFocus() {\n    let scrollTop = this.quill.scrollingContainer.scrollTop;\n    this.quill.focus();\n    this.quill.scrollingContainer.scrollTop = scrollTop;\n  }\n\n  save() {\n    let value = this.textbox.value;\n    switch(this.root.getAttribute('data-mode')) {\n      case 'link': {\n        let scrollTop = this.quill.root.scrollTop;\n        if (this.linkRange) {\n          this.quill.formatText(this.linkRange, 'link', value, Emitter.sources.USER);\n          delete this.linkRange;\n        } else {\n          this.restoreFocus();\n          this.quill.format('link', value, Emitter.sources.USER);\n        }\n        this.quill.root.scrollTop = scrollTop;\n        break;\n      }\n      case 'video': {\n        value = extractVideoUrl(value);\n      } // eslint-disable-next-line no-fallthrough\n      case 'formula': {\n        if (!value) break;\n        let range = this.quill.getSelection(true);\n        if (range != null) {\n          let index = range.index + range.length;\n          this.quill.insertEmbed(index, this.root.getAttribute('data-mode'), value, Emitter.sources.USER);\n          if (this.root.getAttribute('data-mode') === 'formula') {\n            this.quill.insertText(index + 1, ' ', Emitter.sources.USER);\n          }\n          this.quill.setSelection(index + 2, Emitter.sources.USER);\n        }\n        break;\n      }\n      default:\n    }\n    this.textbox.value = '';\n    this.hide();\n  }\n}\n\n\nfunction extractVideoUrl(url) {\n  let match = url.match(/^(?:(https?):\\/\\/)?(?:(?:www|m)\\.)?youtube\\.com\\/watch.*v=([a-zA-Z0-9_-]+)/) ||\n              url.match(/^(?:(https?):\\/\\/)?(?:(?:www|m)\\.)?youtu\\.be\\/([a-zA-Z0-9_-]+)/);\n  if (match) {\n    return (match[1] || 'https') + '://www.youtube.com/embed/' + match[2] + '?showinfo=0';\n  }\n  if (match = url.match(/^(?:(https?):\\/\\/)?(?:www\\.)?vimeo\\.com\\/(\\d+)/)) {  // eslint-disable-line no-cond-assign\n    return (match[1] || 'https') + '://player.vimeo.com/video/' + match[2] + '/';\n  }\n  return url;\n}\n\nfunction fillSelect(select, values, defaultValue = false) {\n  values.forEach(function(value) {\n    let option = document.createElement('option');\n    if (value === defaultValue) {\n      option.setAttribute('selected', 'selected');\n    } else {\n      option.setAttribute('value', value);\n    }\n    select.appendChild(option);\n  });\n}\n\n\nexport { BaseTooltip, BaseTheme as default };\n"]},"metadata":{},"sourceType":"module"}